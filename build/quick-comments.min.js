!function(a){function b(a){var b={val:a},c=a.split(/\s+in\s+/);return c[1]&&(b.val=A(0)+c[1],c=c[0].slice(A(0).length).trim().split(/,\s*/),b.key=c[0],b.pos=c[1]),b}function c(a,b,c){var d={};return d[a.key]=b,a.pos&&(d[a.pos]=c),d}function d(a,d,e){function f(a,b,c){n.splice(a,0,b),o.splice(a,0,c)}l(a,"each");var h,i=a.outerHTML,j=a.previousSibling,m=a.parentNode,n=[],o=[];e=b(e),d.one("update",function(){m.removeChild(a)}).one("premount",function(){m.stub&&(m=d.root)}).on("update",function(){var a=B(e.val,d);if(a){if(!Array.isArray(a)){var b=JSON.stringify(a);if(b==h)return;h=b,k(o,function(a){a.unmount()}),n=[],o=[],a=Object.keys(a).map(function(b){return c(e,b,a[b])})}k(n,function(b){if(b instanceof Object){if(a.indexOf(b)>-1)return}else{var c=t(a,b),d=t(n,b);if(c.length>=d.length)return}var e=n.indexOf(b),f=o[e];return f?(f.unmount(),n.splice(e,1),o.splice(e,1),!1):void 0});var l=[].indexOf.call(m.childNodes,j)+1;k(a,function(b,j){var k=a.indexOf(b,j),p=n.indexOf(b,j);if(0>k&&(k=a.lastIndexOf(b,j)),0>p&&(p=n.lastIndexOf(b,j)),!(b instanceof Object)){var q=t(a,b),r=t(n,b);q.length>r.length&&(p=-1)}var s=m.childNodes;if(0>p){if(!h&&e.key)var u=c(e,b,k);var v=new g({tmpl:i},{before:s[l+k],parent:d,root:m,item:u||b});return v.mount(),f(k,b,v),!0}return e.pos&&o[p][e.pos]!=k&&(o[p].one("update",function(a){a[e.pos]=k}),o[p].update()),k!=p?(m.insertBefore(s[l+p],s[l+(k>p?k+1:k)]),f(k,n.splice(p,1)[0],o.splice(p,1)[0])):void 0}),n=a.slice()}})}function e(a,b,c){q(a,function(a){if(1==a.nodeType){a.parentNode&&a.parentNode.isLoop&&(a.isLoop=1),a.getAttribute("each")&&(a.isLoop=1);var d=v(a);if(d&&!a.isLoop){for(var e,f=new g(d,{root:a,parent:b},a.innerHTML),h=d.name,i=b;!v(i.root)&&i.parent;)i=i.parent;f.parent=i,e=i.tags[h],e?(Array.isArray(e)||(i.tags[h]=[e]),i.tags[h].push(f)):i.tags[h]=f,a.innerHTML="",c.push(f)}k(a.attributes,function(c){/^(name|id)$/.test(c.name)&&(b[c.value]=a)})}})}function f(a,b,c){function e(a,b,d){if(b.indexOf(A(0))>=0){var e={dom:a,expr:b};c.push(m(e,d))}}q(a,function(a){var c=a.nodeType;if(3==c&&"STYLE"!=a.parentNode.tagName&&e(a,a.nodeValue),1==c){var f=a.getAttribute("each");return f?(d(a,b,f),!1):(k(a.attributes,function(b){var c=b.name,d=c.split("__")[1];return e(a,b.value,{attr:d||c,bool:d}),d?(l(a,c),!1):void 0}),v(a)?!1:void 0)}})}function g(a,b,c){function d(){k(Object.keys(z),function(a){l[a]=B(z[a],o||i)})}function g(a){if(k(s,function(b){b[a?"mount":"unmount"]()}),o){var b=a?"on":"off";o[b]("update",i.update)[b]("unmount",i.unmount)}}var h,i=y.observable(this),l=u(b.opts)||{},n=p(a.tmpl),o=b.parent,q=[],s=[],t=b.root,v=b.item,w=a.fn,x=t.tagName.toLowerCase(),z={};w&&t._tag&&t._tag.unmount(!0),t._tag=this,this._id=~~((new Date).getTime()*Math.random()),m(this,{parent:o,root:t,opts:l,tags:{}},v),k(t.attributes,function(a){z[a.name]=a.value}),n.innerHTML&&!/select/.test(x)&&(n.innerHTML=r(n.innerHTML,c)),this.update=function(a,b){m(i,a,v),d(),i.trigger("update",v),j(q,i,v),i.trigger("updated")},this.mount=function(){if(d(),w&&w.call(i,l),g(!0),f(n,i,q),i.parent||i.update(),i.trigger("premount"),w)for(;n.firstChild;)t.appendChild(n.firstChild);else h=n.firstChild,t.insertBefore(h,b.before||null);t.stub&&(i.root=t=o.root),i.trigger("mount")},this.unmount=function(a){var b=w?t:h,c=b.parentNode;if(c){if(o)Array.isArray(o.tags[x])?k(o.tags[x],function(a,b){a._id==i._id&&o.tags[x].splice(b,1)}):delete o.tags[x];else for(;b.firstChild;)b.removeChild(b.firstChild);a||c.removeChild(b)}i.trigger("unmount"),g(),i.off("*"),t._tag=null},e(n,this,s)}function h(b,c,d,e,f){d[b]=function(b){b=b||a.event,b.which=b.which||b.charCode||b.keyCode,b.target=b.target||b.srcElement,b.currentTarget=d,b.item=f,c.call(e,b)===!0||/radio|check/.test(d.type)||(b.preventDefault&&b.preventDefault(),b.returnValue=!1);var g=f?e.parent:e;g.update()}}function i(a,b,c){a&&(a.insertBefore(c,b),a.removeChild(b))}function j(a,b,c){k(a,function(a,d){var e=a.dom,f=a.attr,g=B(a.expr,b),j=a.dom.parentNode;if(null==g&&(g=""),j&&"TEXTAREA"==j.tagName&&(g=g.replace(/riot-/g,"")),a.value!==g){if(a.value=g,!f)return e.nodeValue=g;if(l(e,f),"function"==typeof g)h(f,g,e,b,c);else if("if"==f){var k=a.stub;g?k&&i(k.parentNode,k,e):(k=a.stub=k||document.createTextNode(""),i(e.parentNode,e,k))}else if(/^(show|hide)$/.test(f))"hide"==f&&(g=!g),e.style.display=g?"":"none";else if("value"==f)e.value=g;else if("riot-"==f.slice(0,5))f=f.slice(5),g?e.setAttribute(f,g):l(e,f);else{if(a.bool){if(e[f]=g,!g)return;g=f}"object"!=typeof g&&e.setAttribute(f,g)}}})}function k(a,b){for(var c,d=0,e=(a||[]).length;e>d;d++)c=a[d],null!=c&&b(c,d)===!1&&d--;return a}function l(a,b){a.removeAttribute(b)}function m(a,b,c){return b&&k(Object.keys(b),function(c){a[c]=b[c]}),c?m(a,c):a}function n(){if(a){var b=navigator.userAgent,c=b.indexOf("MSIE ");return c>0?parseInt(b.substring(c+5,b.indexOf(".",c)),10):0}}function o(a,b){var c=document.createElement("option"),d=/value=[\"'](.+?)[\"']/,e=/selected=[\"'](.+?)[\"']/,f=b.match(d),g=b.match(e);c.innerHTML=b,f&&(c.value=f[1]),g&&c.setAttribute("riot-selected",g[1]),a.appendChild(c)}function p(a){var b=a.trim().slice(1,3).toLowerCase(),c=/td|th/.test(b)?"tr":"tr"==b?"tbody":"div",d=document.createElement(c);return d.stub=!0,"op"===b&&z&&10>z?o(d,a):d.innerHTML=a,d}function q(a,b){if(a)if(b(a)===!1)q(a.nextSibling,b);else for(a=a.firstChild;a;)q(a,b),a=a.nextSibling}function r(a,b){return a.replace(/<(yield)\/?>(<\/\1>)?/gim,b||"")}function s(a,b){return b=b||document,b.querySelectorAll(a)}function t(a,b){return a.filter(function(a){return a===b})}function u(a){function b(){}return b.prototype=a,new b}function v(a){return D[a.getAttribute("riot-tag")||a.tagName.toLowerCase()]}function w(a){var b=document.createElement("style");b.innerHTML=a,document.head.appendChild(b)}function x(a,b,c){var d=D[b],e=a.innerHTML;return a.innerHTML="",d&&a&&(d=new g(d,{root:a,opts:c},e)),d&&d.mount?(d.mount(),C.push(d),d.on("unmount",function(){C.splice(C.indexOf(d),1)})):void 0}var y={version:"v2.0.15",settings:{}},z=n();y.observable=function(a){a=a||{};var b={},c=0;return a.on=function(d,e){return"function"==typeof e&&(e._id="undefined"==typeof e._id?c++:e._id,d.replace(/\S+/g,function(a,c){(b[a]=b[a]||[]).push(e),e.typed=c>0})),a},a.off=function(c,d){return"*"==c?b={}:c.replace(/\S+/g,function(a){if(d)for(var c,e=b[a],f=0;c=e&&e[f];++f)c._id==d._id&&(e.splice(f,1),f--);else b[a]=[]}),a},a.one=function(b,c){function d(){a.off(b,d),c.apply(a,arguments)}return a.on(b,d)},a.trigger=function(c){for(var d,e=[].slice.call(arguments,1),f=b[c]||[],g=0;d=f[g];++g)d.busy||(d.busy=1,d.apply(a,d.typed?[c].concat(e):e),f[g]!==d&&g--,d.busy=0);return b.all&&"all"!=c&&a.trigger.apply(a,["all",c].concat(e)),a},a},function(a,b,c){function d(){return h.href.split("#")[1]||""}function e(a){return a.split("/")}function f(a){a.type&&(a=d()),a!=g&&(i.trigger.apply(null,["H"].concat(e(a))),g=a)}if(c){var g,h=c.location,i=a.observable(),j=c,k=!1,l=a.route=function(a){a[0]?(h.hash=a,f(a)):i.on("H",a)};l.exec=function(a){a.apply(null,e(d()))},l.parser=function(a){e=a},l.stop=function(){k&&(j.removeEventListener?j.removeEventListener(b,f,!1):j.detachEvent("on"+b,f),i.off("*"),k=!1)},l.start=function(){k||(j.addEventListener?j.addEventListener(b,f,!1):j.attachEvent("on"+b,f),k=!0)},l.start()}}(y,"hashchange",a);var A=function(a,b,c){return function(d){return b=y.settings.brackets||a,c!=b&&(c=b.split(" ")),d&&d.test?b==a?d:RegExp(d.source.replace(/\{/g,c[0].replace(/(?=.)/g,"\\")).replace(/\}/g,c[1].replace(/(?=.)/g,"\\")),d.global?"g":""):c[d]}}("{ }"),B=function(){function b(a,b){return a=(a||A(0)+A(1)).replace(A(/\\{/g),"￰").replace(A(/\\}/g),"￱"),b=e(a,f(a,A(/{/),A(/}/))),new Function("d","return "+(b[0]||b[2]||b[3]?"["+b.map(function(a,b){return b%2?c(a,!0):'"'+a.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':c(b[1])).replace(/\uFFF0/g,A(0)).replace(/\uFFF1/g,A(1))+";")}function c(a,b){return a=a.replace(/\n/g," ").replace(A(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),""),/^\s*[\w- "']+ *:/.test(a)?"["+f(a,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(a){return a.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(a,b,c){return c.replace(/[^&|=!><]+/g,d)+'?"'+b+'":"",'})}).join("")+'].join(" ").trim()':d(a,b)}function d(b,c){return b=b.trim(),b?"(function(v){try{v="+(b.replace(h,function(b,c,d){return d?"(d."+d+"===undefined?"+("undefined"==typeof a?"global.":"window.")+d+":d."+d+")":b})||"x")+"}finally{return "+(c===!0?'!v&&v!==0?"":v':"v")+"}}).call(d)":""}function e(a,b){var c=[];return b.map(function(b,d){d=a.indexOf(b),c.push(a.slice(0,d),b),a=a.slice(d+b.length)}),c.concat(a)}function f(a,b,c){var d,e=0,f=[],g=new RegExp("("+b.source+")|("+c.source+")","g");return a.replace(g,function(b,c,g,h){!e&&c&&(d=h),e+=c?1:-1,e||null==g||f.push(a.slice(d,h+g.length))}),f}var g={},h=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(a,c){return a&&(g[a]=g[a]||b(a))(c)}}(),C=[],D={};y.tag=function(a,b,c,d){return"function"==typeof c?d=c:c&&w(c),D[a]={name:a,tmpl:b,fn:d},a},y.mount=function(a,b,c){function d(a){var d=b||a.getAttribute("riot-tag")||a.tagName.toLowerCase(),e=x(a,d,c);e&&g.push(e)}var e,f=function(a){return a=Object.keys(D).join(", "),a.split(",").map(function(b){a+=', *[riot-tag="'+b.trim()+'"]'}),a},g=[];if("object"==typeof b&&(c=b,b=0),"string"==typeof a?("*"==a&&(a=f(a)),e=s(a)):e=a,"*"==b){if(b=f(a),e.tagName)e=s(b,e);else{var h=[];k(e,function(a){h=s(b,a)}),e=h}b=0}return e.tagName?d(a):k(e,d),g},y.update=function(){return k(C,function(a){a.update()})},y.mountTo=y.mount,y.util={brackets:A,tmpl:B},"object"==typeof exports?module.exports=y:"function"==typeof define&&define.amd?define(function(){return y}):a.riot=y}("undefined"!=typeof window?window:void 0),function(a){"use strict";function b(a){var b,e=c(a.units),f=Date.now(),h=d(a.from,e,f),i=d(a.to,e,f),j=h-i;return j>=0?b="past":(b="future",j=-j),g(j,b,a.lang)}function c(a){if("undefined"==typeof a)return"ms";if("s"===a||"ms"===a)return a;throw new Error("Invalid units")}function d(a,b,c){if("undefined"==typeof a)return c;if("string"==typeof a&&(a=parseInt(a,10)),e(a)&&f(a))throw new Error("Invalid time");return"number"==typeof a&&"s"===b&&(a*=1e3),a}function e(a){return"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime())}function f(a){return"number"!=typeof a||isNaN(a)}function g(a,b,c){var d,e,f=j[c]||j[k];for(d in i)if(i.hasOwnProperty(d)&&a>=i[d])return e=Math.floor(a/i[d]),f[b](e,f[d][(e>1)+0]);return f.defaults[b]}function h(){"function"==typeof define&&define.amd?define(function(){return l}):"undefined"!=typeof module&&null!==module?module.exports=l:a.vagueTime=l}var i={year:315576e5,month:26298e5,week:6048e5,day:864e5,hour:36e5,minute:6e4},j={en:{year:["year","years"],month:["month","months"],week:["week","weeks"],day:["day","days"],hour:["hour","hours"],minute:["minute","minutes"],past:function(a,b){return a+" "+b+" ago"},future:function(a,b){return"in "+a+" "+b},defaults:{past:"just now",future:"soon"}}},k="en",l={get:b};h()}(this),riot.tag2("comment",'<div class="qc-comment" id="comment/{id.substr(-7)}"> <div class="avatar"> <a href="{author.url}"><img riot-src="{author.avatar}"></a> </div> <div class="qc-header"> <a href="{author.url}" class="{author:1, text-muted:b}">{author.name}</a> | <a href="#comment/{id}" class="{timestamp:1, text-muted:b}" title="{new Date(opts.data.time).toLocaleString()}">{vagueTime}</a> <a href="#" role="button" class="{edit:1, text-muted:b}" if="{false}">Edit</a> </div> <div class="qc-body"> <p each="{p in paragraphs}">{p}</p> </div> <hr> </div>',"","",function(a){this.id=a.data.id,this.author=a.data.author,this.parent.parent.opts.meow&&(a.data.body=a.data.body.replace(/[A-Za-z]+/g,"meow")),this.paragraphs=a.data.body.split(/\n+/);var b=window.vagueTime||!1;this.vagueTime=b?b.get({to:a.data.time}):new Date(a.data.time).toLocaleString(),this.b=this.parent.parent.opts.bootstrap},"{ }"),riot.tag2("newcomment",'<div class="qc-comment qc-new"> <fieldset> <textarea __disabled="{parent.Auth.loggedIn() ? undefined : true}" rows="{height}" class="{gc-new-body:1, form-control:b}" name="body" onfocus="{grow}" onblur="{shrink}" onkeydown="{update}" placeholder="{parent.Auth.loggedIn() ? \'Leave a comment\' : \'Sign in to post a comment.\'}"></textarea> <div class="qc-user qc-logged-in" if="{parent.Auth.loggedIn()}"> <p>Logged in as {parent.Auth.currentUser().name} (via {capitalize(parent.Auth.currentUser().provider)}). <a href="#" role="button" onclick="{logout}"> Log out or switch accounts</a> </p> </div> <div class="{qc-signin:1, input-group-btn:b}" if="{!parent.Auth.loggedIn() || b}"> <button class="{qc-logged-out:1, btn:b, btn-default:b, dropdown-toggle:b}" data-toggle="dropdown" if="{!parent.Auth.loggedIn() && b}">Sign in<span class="caret"></span></button> <span if="{!b}">Sign in:</span> <ul class="{qc-login-opts:1, dropdown-menu:b, dropdown-menu-right:b}" role="menu"> <li each="{name, val in parent.Auth.providers}" if="{val.available}"> <a href="#" role="button" onclick="{parent.login}" class="provider {name}">{parent.capitalize(name)}</a> </li> </ul> </div> <button __disabled="{this.body.value.length ? undefined : true}" class="{submit:1, btn:b, btn-primary:b}" name="submit" onclick="{send}" if="{parent.Auth.loggedIn()}">Submit</button> </fieldset> <hr> </div>',"","",function(a){this.height=1,this.b=this.parent.opts.bootstrap,this.send=function(a){if(!this.spamFree())throw"Can't save spammy comments";this.body.value.length&&(this.parent.save(this),this.body.value="",this.shrink())}.bind(this),this.spamFree=function(){return!0}.bind(this),this.grow=function(a){this.height=5}.bind(this),this.shrink=function(a){this.body.value.length<1&&(this.height=1)}.bind(this),this.login=function(a){this.parent.Auth.login(a.item.name)}.bind(this),this.logout=function(a){this.parent.Auth.logout()}.bind(this),this.change=function(a,b){this.update()}.bind(this),this.parent.Auth.on("login logout",this.change),this.capitalize=function(a){return a.split(" ").map(function(a){var b=a.split("");return b.unshift(b.shift().toUpperCase()),b.join("")}).join(" ")}.bind(this)},"{ }"),riot.tag2("qcomment",'<h2 id="comments">Comments ({comments.length})</h2> <newcomment></newcomment> <div class="qc-comments"><comment each="{comments}" data="{this}"></comment></div>',"","",function(a){this.providers=a.providers,this.pageID=a.pageID,this.firebase=a.firebase,this.Auth=a.Auth,this.dataset=this.firebase.child("comments").child(this.pageID),this.comments=[],this.save=function(b){if(!a.Auth.currentUser())throw"Must be logged in to comment";this.dataset.push({author:this.Auth.currentUser(),time:Date.now(),body:b.body.value})}.bind(this),this.getComment=function(a){var b=a.val();return b.id=a.key(),b}.bind(this),this.addComment=function(a){var b=this.getComment(a);return this.comments.unshift(b),this.update()}.bind(this),this.updateComment=function(a){for(var b=this.getComment(a),c=this.comments.length;c-- >0;)if(this.comments[c].id===b.id)return this.comments[c]=b,this.update()}.bind(this),this.removeComment=function(a){for(var b=this.getComment(a),c=this.comments.length;c-- >0;)if(this.comments[c].id===b.id)return this.comments.splice(c,1),this.update()}.bind(this);var b=this.dataset.orderByChild("time").limitToFirst(a.limit);b.on("child_added",this.addComment),b.on("child_changed",this.updateComment),b.on("child_removed",this.removeComment),this.core.innerText=".qc-header {overflow: hidden;}.qc-body {overflow: hidden;}.qc-new textarea {width: 100%;}.avatar img {max-width: 5em;}"},"{ }");var QC=function(a){function b(b,c){a.observable(this),this.providers=c,this.currentUser=function(){var a=b.getAuth();if(!a)return null;var c=a[a.provider].cachedUserProfile,d={};switch(d.name=a[a.provider].displayName,d.uid=a.uid,d.provider=a.provider,a.provider){case"facebook":d.avatar=c.picture.data.url,d.url=c.link;break;case"twitter":d.avatar=c.profile_image_url,d.url="http://twitter.com/"+c.screen_name;break;case"github":d.avatar=c.avatar_url,d.url=c.html_url;break;case"google":d.avatar=c.picture,d.url=c.link}return d},this.loggedIn=function(){return!!b.getAuth()};var d=this;b.onAuth(function(a){return a?(b.child("users").child(a.uid).set(a),d.trigger("login",a)):d.trigger("logout")}),this.login=function(a){if(this.currentUser())throw"Already logged in";var c=this.providers[a];if(!c||c.available===!1)throw"Provider unavailable";b[c.type||"authWithOAuthPopup"](a,function(a,b){if(a)throw a})},this.logout=function(){b.unauth()}}var c={facebook:{available:!0},github:{available:!0},twitter:{available:!0},google:{available:!0},password:{type:"authWithPassword",available:!1},anonymous:{type:"authAnonymously",available:!1},custom:{type:"authWithCustomToken",available:!1}};return function(d){if(!d.firebase)throw"Firebase is required";d.pageID=encodeURIComponent(d.pageID||window.location.pathname).replace(".","-"),d.limit=d.limit>0?d.limit:100;for(var e in d.authMethods)d.authMethods.hasOwnProperty(e)&&!d.authMethods[e]&&c.hasOwnProperty(e)&&(c[e].available=!1);d.Auth=new b(d.firebase,c),a.mount("qcomment",d)}}(riot);