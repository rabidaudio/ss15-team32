riot.tag("comment",'<div class="qc-comment" name="{ opts.data.id }"> <div class="qc-body">{ opts.data.body }</div> <div class="qc-author"> <a href="mailto:{ opts.data.author.email }">{ opts.data.author.name }</a> </div> <hr></hr> </div>',function(){}),riot.tag("newcomment",'<div class="qc-comment qc-new"> <div class="qc-user qc-logged-out" if="{ !parent.user }"> <p>Sign in to post a comment.</p> <ul class="qc-login-opts"> <li each="{ parent.providers }"> <a href="#" class="provicer-{ name }" onclick="{ login }">{ name }</a> </li> </ul> </div> <div class="qc-user qc-logged-in" if="{ parent.user }"> { parent.user.name } </div> <form>      <textarea rows="{ height }" class="gc-new-body form-control" name="body" onfocus="{ grow }"></textarea>\n <button class="submit" name="submit" onclick="{ send }">Submit</button> </form> <hr></hr> </div>',function(){this.height=1,this.send=function(){if(!this.spamFree)throw"Can't save spammy comments";this.parent.save(this),body.value="",this.shrink()}.bind(this),this.spamFree=function(){return!0}.bind(this),this.grow=function(){this.height=5}.bind(this),this.shrink=function(){this.height=1}.bind(this)}),riot.tag("qcommentcontainer",'<div class="qc-comments"> <newcomment></newcomment> <comment each="{ comments }" data="{ this }"></comment> </div>',function(a){this.providers=a.providers,this.pageID=a.pageID,this.FB=a.FB,this.dataset=this.FB.child("comments").child(this.pageID),this.comments=[],this.user={name:"bob",email:"abc@123.xyz"},this.save=function(a){this.dataset.push({author:this.user,time:(new Date).toISOString(),body:a.body.value})}.bind(this),this.getComment=function(a){var b=a.val();return b.id=a.key(),b}.bind(this),this.addComment=function(a){var b=this.getComment(a);return this.comments.unshift(b),this.update()}.bind(this),this.updateComment=function(a){for(var b=this.getComment(a),c=this.comments.length;c-->0;)if(this.comments[c].id===b.id)return this.comments[c]=b,this.update()}.bind(this),this.removeComment=function(a){for(var b=this.getComment(a),c=this.comments.length;c-->0;)if(this.comments[c].id===b.id)return this.comments.splice(c,1),this.update()}.bind(this),this.dataset.on("child_added",this.addComment),this.dataset.on("child_changed",this.updateComment),this.dataset.on("child_removed",this.removeComment)});var QC=function(a,b){if(!a)throw"Riot.js is required";if(!b)throw"Firebase is required";return function(c){a.mount("qcommentcontainer",{FB:new b(c.firebase),pageID:c.pageID||encodeURIComponent(window.location.pathname),providers:[{name:"facebook",login:function(){console.log("yay!")}}]})}}(riot,Firebase);