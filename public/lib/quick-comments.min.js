var riot={version:"v2.0.1"};riot.observable=function(a){var b={};return a.on=function(c,d){return"function"==typeof d&&c.replace(/\S+/g,function(a,c){(b[a]=b[a]||[]).push(d),d.typed=c>0}),a},a.off=function(c,d){if("*"==c)b={};else if(d)for(var e,f=b[c],g=0;e=f&&f[g];++g)e==d&&(f.splice(g,1),g--);else c.replace(/\S+/g,function(a){b[a]=[]});return a},a.one=function(b,c){return c&&(c.one=1),a.on(b,c)},a.trigger=function(c){for(var d,e=[].slice.call(arguments,1),f=b[c]||[],g=0;d=f[g];++g)d.busy||(d.busy=1,d.apply(a,d.typed?[c].concat(e):e),d.one&&(f.splice(g,1),g--),d.busy=0);return a},a},function(a,b){function c(){return e.hash.slice(1)}function d(a){a.type&&(a=c()),a!=g&&(f.trigger.apply(null,["H"].concat(a.split("/"))),g=a)}if(this.top){var e=location,f=a.observable({}),g=c(),h=window,i=a.route=function(a){a[0]?(e.hash=a,d(a)):f.on("H",a)};i.exec=function(a){a.apply(null,c().split("/"))},h.addEventListener?h.addEventListener(b,d,!1):h.attachEvent("on"+b,d)}}(riot,"hashchange"),riot._tmpl=function(){function a(a,c){return c=(a||"{}").replace(/\\{/g,"￰").replace(/\\}/g,"￱").split(/({[\s\S]*?})/),new Function("d","return "+(c[0]||c[2]?"["+c.map(function(a,c){return c%2?b(a,1):'"'+a.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':b(c[1])).replace(/\uFFF0/g,"{").replace(/\uFFF1/g,"}"))}function b(a,b){return a=a.replace(/\n/g," ").replace(/^[{ ]+|[ }]+$|\/\*.+?\*\//g,""),/^\s*[\w-"']+ *:/.test(a)?"["+a.replace(/\W*([\w-]+)\W*:([^,]+)/g,function(a,d,e){return e.replace(/\w[^,|& ]*/g,function(a){return c(a,b)})+'?"'+d+'":"",'})+'].join(" ")':c(a,b)}function c(a,b){return"(function(v){try{v="+(a.replace(e,function(a,b,c){return c?"d."+c:a})||"x")+"}finally{return "+(b?'!v&&v!==0?"":v':"v")+"}}).call(d)"}var d={},e=/("|').+?[^\\]\1|\.\w*|\w*:|\b(?:this|true|false|null|new|typeof|Number|String|Object|Array|Math|Date)\b|([a-z_]\w*)/gi;return function(b,c){return b&&(d[b]=d[b]||a(b))(c)}}(),function(a,b){function c(a,b){for(var c=0;c<(a||[]).length;c++)b(a[c],c)===!1&&c--}function d(a,b){return b&&Object.keys(b).map(function(c){a[c]=b[c]}),a}function e(a,b){return a.filter(function(a){return b.indexOf(a)<0})}function f(a,b){for(a=b(a)===!1?a.nextSibling:a.firstChild;a;)f(a,b),a=a.nextSibling}function g(a){var c=b.createElement("div");return c.innerHTML=a,c}function h(a,b){b.trigger("update"),c(a,function(a){function c(a){e.removeAttribute(a)}var d=a.tag,e=a.dom;if(a.loop)return c("each"),k(a,b);if(d)return d.update?d.update():a.tag=j({tmpl:d[0],fn:d[1],root:e,parent:b});var f=a.attr,g=l(a.expr,b);if(null==g&&(g=""),a.value!==g){if(a.value=g,!f)return e.nodeValue=g;if((!g&&a.bool||/obj|func/.test(typeof g))&&c(f),"function"==typeof g)e[f]=function(a){a=a||window.event,a.which=a.which||a.charCode||a.keyCode,a.target=a.target||a.srcElement,a.currentTarget=e,a.item=b.__item||b,g.call(b,a)!==!0&&(a.preventDefault&&a.preventDefault(),a.returnValue=!1),b.update()};else if(/^(show|hide|if)$/.test(f))c(f),"hide"==f&&(g=!g),e.style.display=g?"":"none";else{if(a.bool){if(!g)return;g=f}e.setAttribute(f,g)}}}),b.trigger("updated")}function i(a){var b={},e=[];return f(a,function(a){function f(b,c){if(b?b.indexOf("{")>=0:c){var f={dom:a,expr:b};e.push(d(f,c||{}))}}var g=a.nodeType,h=a.nodeValue;if(3==g&&"STYLE"!=a.parentNode.tagName)f(h);else if(1==g){if(h=a.getAttribute("each"))return f(h,{loop:1}),!1;var i=n[a.tagName.toLowerCase()];c(a.attributes,function(c){var d=c.name,e=c.value;if(/^(name|id)$/.test(d)&&(b[e]=a),!i){var g=d.split("__")[1];if(f(e,{attr:g||d,bool:g}),g)return a.removeAttribute(d),!1}}),i&&f(0,{tag:i})}}),{expr:e,elem:b}}function j(e){function f(){Object.keys(r).map(function(a){var b=j[a]=l(r[a],o||q);"object"==typeof b&&n.removeAttribute(a)})}var j=e.opts||{},k=g(e.tmpl),n=e.root,o=e.parent,p=i(k),q={root:n,opts:j,parent:o,__item:e.item},r={};for(d(q,p.elem),c(n.attributes,function(a){r[a.name]=a.value}),f(),q.on||(a.observable(q),delete q.off),e.fn&&e.fn.call(q,j),q.update=function(a,c){return o&&k&&!k.firstChild&&(n=o.root,k=null),c||b.body.contains(n)?(d(q,a),d(q,q.__item),f(),h(p.expr,q),!c&&q.__item&&o.update(),!0):void q.trigger("unmount")},q.update(0,!0);k.firstChild;)e.before?n.insertBefore(k.firstChild,e.before):n.appendChild(k.firstChild);return q.trigger("mount"),m.push(q),q}function k(a,b){function c(){return Array.prototype.indexOf.call(f.childNodes,i)+1}if(!a.done){a.done=!0;var d,f,g,h=a.dom,i=h.previousSibling,f=h.parentNode,k=h.outerHTML,m=a.expr,n=m.split(/\s+in\s+/),o=[];n[1]&&(m="{ "+n[1],g=n[0].slice(1).trim().split(/,\s*/)),b.one("mount",function(){var a=h.parentNode;a&&(f=a,f.removeChild(h))}),b.on("updated",function(){var a=l(m,b);if(is_array=Array.isArray(a),is_array)a=a.slice(0);else{if(!a)return;var h=JSON.stringify(a);if(h==d)return;d=h,a=Object.keys(a).map(function(b){var c={};return c[g[0]]=b,c[g[1]]=a[b],c})}e(o,a).map(function(a){var b=o.indexOf(a);f.removeChild(f.childNodes[c()+b]),o.splice(b,1)}),e(a,o).map(function(e,h){var i=a.indexOf(e);if(g&&!d){var l={};l[g[0]]=e,l[g[1]]=h,e=l}var m=j({before:f.childNodes[c()+i],parent:b,tmpl:k,item:e,root:f});b.on("update",function(){m.update(0,!0)})}),o=a})}}var l=a._tmpl,m=[],n={};a.tag=function(a,b,c){c=c||noop,n[a]=[b,c]},a.mountTo=function(a,b,c){var d=n[b];return d&&j({tmpl:d[0],fn:d[1],root:a,opts:c})},a.mount=function(d,e){"*"==d&&(d=Object.keys(n).join(", "));var f=[];return c(b.querySelectorAll(d),function(b){if(!b.riot){var c=b.tagName.toLowerCase(),d=a.mountTo(b,c,e);d&&(f.push(d),b.riot=1)}}),f},a.update=function(){return m=m.filter(function(a){return!!a.update()})}}(riot,document),function(a){"use strict";function b(a){var b,e=c(a.units),f=Date.now(),h=d(a.from,e,f),i=d(a.to,e,f),j=h-i;return j>=0?b="past":(b="future",j=-j),g(j,b,a.lang)}function c(a){if("undefined"==typeof a)return"ms";if("s"===a||"ms"===a)return a;throw new Error("Invalid units")}function d(a,b,c){if("undefined"==typeof a)return c;if("string"==typeof a&&(a=parseInt(a,10)),e(a)&&f(a))throw new Error("Invalid time");return"number"==typeof a&&"s"===b&&(a*=1e3),a}function e(a){return"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime())}function f(a){return"number"!=typeof a||isNaN(a)}function g(a,b,c){var d,e,f=j[c]||j[k];for(d in i)if(i.hasOwnProperty(d)&&a>=i[d])return e=Math.floor(a/i[d]),f[b](e,f[d][(e>1)+0]);return f.defaults[b]}function h(){"function"==typeof define&&define.amd?define(function(){return l}):"undefined"!=typeof module&&null!==module?module.exports=l:a.vagueTime=l}var i={year:315576e5,month:26298e5,week:6048e5,day:864e5,hour:36e5,minute:6e4},j={en:{year:["year","years"],month:["month","months"],week:["week","weeks"],day:["day","days"],hour:["hour","hours"],minute:["minute","minutes"],past:function(a,b){return a+" "+b+" ago"},future:function(a,b){return"in "+a+" "+b},defaults:{past:"just now",future:"soon"}}},k="en",l={get:b};h()}(this),riot.tag("comment",'<div class="qc-comment" id="comment/{id.substr(-7)}"> <div class="avatar"> <a href="{author.url}"><img src="{author.avatar}"></a> </div> <div class="qc-header"> <a href="{author.url}" class="{author:1, text-muted:b}">{author.name}</a> |  <a href="#comment/{id}" class="{timestamp:1, text-muted:b}" title="{new Date(opts.data.time).toLocaleString()}">{vagueTime}</a> <a href="#" role="button" class="{edit:1, text-muted:b}" if="{false}">Edit</a> </div> <div class="qc-body"> <p each="{p in paragraphs}">{p}</p> </div> <hr></hr> </div>',function(a){this.id=a.data.id,this.author=a.data.author,this.parent.parent.opts.meow&&(a.data.body=a.data.body.replace(/[A-Za-z]+/g,"meow")),this.paragraphs=a.data.body.split(/\n+/);var b=window.vagueTime||!1;this.vagueTime=b?b.get({to:a.data.time}):new Date(a.data.time).toLocaleString(),this.b=this.parent.parent.opts.bootstrap}),riot.tag("newcomment",'<div class="qc-comment qc-new"> <fieldset>      <textarea __disabled="{parent.Auth.loggedIn() ? undefined : true}" rows="{height}" class="{gc-new-body:1, form-control:b}" name="body" onfocus="{grow}" onblur="{shrink}" onkeydown="{update}" placeholder="{parent.Auth.loggedIn() ? \'Leave a comment\' : \'Sign in to post a comment.\'}"></textarea>\n <div class="qc-user qc-logged-in" if="{parent.Auth.loggedIn()}"> <p>Logged in as {parent.Auth.currentUser().name} (via {capitalize(parent.Auth.currentUser().provider)}). <a href="#" role="button" onclick="{logout}"> Log out or switch accounts</a> </p> </div> <div class="{qc-signin:1, input-group-btn:b}" if="{!parent.Auth.loggedIn() || b}"> <button class="{qc-logged-out:1, btn:b, btn-default:b, dropdown-toggle:b}" data-toggle="dropdown" if="{!parent.Auth.loggedIn() && b}">Sign in<span class="caret"></span></button> <span if="{!b}">Sign in:</span> <ul class="{qc-login-opts:1, dropdown-menu:b, dropdown-menu-right:b}" role="menu"> <li each="{name, val in parent.Auth.providers}" if="{val.available}"> <a href="#" role="button" onclick="{parent.login}" class="provider {name}">{parent.capitalize(name)}</a> </li> </ul> </div> <button __disabled="{this.body.value.length ? undefined : true}" class="{submit:1, btn:b, btn-primary:b}" name="submit" onclick="{send}" if="{parent.Auth.loggedIn()}">Submit</button> </fieldset> <hr></hr> </div>',function(){this.height=1,this.b=this.parent.opts.bootstrap,this.send=function(){if(!this.spamFree())throw"Can't save spammy comments";this.body.value.length&&(this.parent.save(this),this.body.value="",this.shrink())}.bind(this),this.spamFree=function(){return!0}.bind(this),this.grow=function(){this.height=5}.bind(this),this.shrink=function(){this.body.value.length<1&&(this.height=1)}.bind(this),this.login=function(a){this.parent.Auth.login(a.item.name)}.bind(this),this.logout=function(){this.parent.Auth.logout()}.bind(this),this.change=function(){this.update()}.bind(this),this.parent.Auth.on("login logout",this.change),this.capitalize=function(a){return a.split(" ").map(function(a){var b=a.split("");return b.unshift(b.shift().toUpperCase()),b.join("")}).join(" ")}.bind(this)}),riot.tag("qcomment",'<style name="core"></style> <h2>Comments ({comments.length})</h2> <newcomment></newcomment> <div class="qc-comments"> <comment each="{comments}" data="{this}"></comment> </div>',function(a){this.providers=a.providers,this.pageID=a.pageID,this.firebase=a.firebase,this.Auth=a.Auth,this.dataset=this.firebase.child("comments").child(this.pageID),this.comments=[],this.save=function(b){if(!a.Auth.currentUser())throw"Must be logged in to comment";this.dataset.push({author:this.Auth.currentUser(),time:Date.now(),body:b.body.value})}.bind(this),this.getComment=function(a){var b=a.val();return b.id=a.key(),b}.bind(this),this.addComment=function(a){var b=this.getComment(a);return this.comments.unshift(b),this.update()}.bind(this),this.updateComment=function(a){for(var b=this.getComment(a),c=this.comments.length;c-->0;)if(this.comments[c].id===b.id)return this.comments[c]=b,this.update()}.bind(this),this.removeComment=function(a){for(var b=this.getComment(a),c=this.comments.length;c-->0;)if(this.comments[c].id===b.id)return this.comments.splice(c,1),this.update()}.bind(this);var b=this.dataset.orderByChild("time").limitToFirst(a.limit);b.on("child_added",this.addComment),b.on("child_changed",this.updateComment),b.on("child_removed",this.removeComment),this.core.innerText=".qc-header {overflow: hidden;}.qc-body {overflow: hidden;}.qc-new textarea {width: 100%;}.avatar img {max-width: 5em;}"});var QC=function(a){function b(b,c){a.observable(this),this.providers=c,this.currentUser=function(){var a=b.getAuth();if(!a)return null;var c=a[a.provider].cachedUserProfile,d={};switch(d.name=a[a.provider].displayName,d.uid=a.uid,d.provider=a.provider,a.provider){case"facebook":d.avatar=c.picture.data.url,d.url=c.link;break;case"twitter":d.avatar=c.profile_image_url,d.url="http://twitter.com/"+c.screen_name;break;case"github":d.avatar=c.avatar_url,d.url=c.html_url;break;case"google":d.avatar=c.picture,d.url=c.link}return d},this.loggedIn=function(){return!!b.getAuth()};var d=this;b.onAuth(function(a){return a?(b.child("users").child(a.uid).set(a),d.trigger("login",a)):d.trigger("logout")}),this.login=function(a){if(this.currentUser())throw"Already logged in";var c=this.providers[a];if(!c||c.available===!1)throw"Provider unavailable";b[c.type||"authWithOAuthPopup"](a,function(a){if(a)throw a})},this.logout=function(){b.unauth()}}var c={facebook:{available:!0},github:{available:!0},twitter:{available:!0},google:{available:!0},password:{type:"authWithPassword",available:!1},anonymous:{type:"authAnonymously",available:!1},custom:{type:"authWithCustomToken",available:!1}};return function(d){if(!d.firebase)throw"Firebase is required";d.pageID=encodeURIComponent(d.pageID||window.location.pathname).replace(".","-"),d.limit=d.limit>0?d.limit:100;for(var e in d.authMethods)d.authMethods.hasOwnProperty(e)&&!d.authMethods[e]&&c.hasOwnProperty(e)&&(c[e].available=!1);d.Auth=new b(d.firebase,c),a.mount("qcomment",d)}}(riot);